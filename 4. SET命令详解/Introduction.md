# 4. SET命令详解

可以使用`set /?`查看SET的帮助。

在上一章中简单的介绍了一下SET设置自定义变量的作用，现在具体讲一下SET的功能。

## 4.1. 用SET命令设置自定义变量

显示、设置或删除 cmd.exe 环境变量。

```
SET [variable=[string]]
```

**variable** 指定环境变量名。

**string** 指定要指派给变量的一系列字符串。

要显示当前环境变量，键入不带参数的SET。

SET命令不允许变量名含有等号。

例：

```
@echo off
set var=我是值
echo %var%
pause
```

请看`set var=我是值`，这就是在批处理中设置变量的方法。

`set`是命令，`var`是变量名，=号右边的`我是值`是变量的值。

在批处理中我们要引用这个量就把变量名用两个%（百分号）扩起来,如`%var%`

SET还可以提供一个交互界面，让用户自己输入变量的值，然后再根据这个值来做相应操作，SET的这种语法，只需要加一个`/P`参数就可以了。

```
SET /P variable=[promptString]
```

例：

```
@echo off
set /p var=请输入变量的值:
echo 您输入的值是:%var%
pause
```

`set /p`是命令语法，`var`是变量名，=号右边的`请输入变量的值:`是提示语，不是变量的值。

运行后，我们在提示语后面直接输入`1`，显示结果：

```
请输入变量的值:1
您输入的值是:1
请按任意键继续...
```

## 4.2. 用SET命令进行简单计算

语法：

```
SET /A expression
```

`/A`命令行开关指定等号右边的字符串为被评估的数字表达式。该表达式
评估器很简单并以递减的优先权顺序支持下列操作：

```
()                  - 分组
! ~ -               - 一元运算符
* / %               - 算数运算符
+ -                 - 算数运算符
<< >>               - 逻辑移位
&                   - 按位“与”
^                   - 按位“异”
|                   - 按位“或”
= *= /= %= += -=    - 算数赋值
&= ^= |= <<= >>=    - 二进制运算赋值
,                   - 表达式分隔符
```

下面简单解释一下：

SET的`/A`参数就是让SET可以支持数学符号进行加减等一些数学运算。

例：

```
@echo off
set /p input=请输入计算表达式:
set /a var=%input%
echo 计算结果:%input%=%var%
pause
```

注意：**DOS计算只能精确到整数**

请看下面几个运算过程：

```
请输入计算表达式:1+9+20+30-10
计算结果:1+9+20+30-10=50
请按任意键继续...
```

```
请输入计算表达式:10/3
计算结果:10/3=3  #DOS计算精确到整数，小数舍了。
请按任意键继续...
```

```
请输入计算表达式:-100+62
计算结果:-100+62=-38
请按任意键继续...
```

```
请输入计算表达式:100%3  #求余数
计算结果:100%3=1
请按任意键继续...
```

```
请输入计算表达式:(25+75)*2/(15+5)
计算结果:(25+75)*2/(15+5)=10
请按任意键继续...
```

```
请输入计算表达式:1234567890*9876543210
无效数字。数字精确度限为 32 位。
计算结果:1234567890*9876543210=
请按任意键继续...
```

注意：上面的计算过程显示，DOS计算只能精确到32位，这个32位是指二进制32位，其中最高位为符号位（0为正，1为负），低位31位为数值。31个1换成十进制为2147483647，所以DOS计算的有效值范围是-2147483647至2147483647，超出该数值范围时计算出错，请看下面的计算过程：

```
请输入计算表达式:2147483647-1  #最大值减1，值有效
计算结果:2147483647-1=2147483646
请按任意键继续...
```

运行：

```
set /a a=1+1,b=2+1,c=3+1
```

后会显示一个`4`（笔者注：好像打开批处理文件不能显示`4`，需要在CMD窗口直接输入命令来观察）。但我们用`echo %a% %b% %c%`后看结果，会发现其他数学运算也有效果，这就是逗号`,`的作用。

有时候我们需要直接在原变量进行加减操作就可以用这种语法
























































